# AGENTS.md

## 目的

FlowSmith の自律開発パイプラインを、安全に保守・改善する。
Issue 起点と PR フィードバック起点の両方で、再現性のある実行を維持する。

## 変更対象の優先範囲

- `scripts/`
- `.github/workflows/`
- `.agent/`
- `docs/`
- `README.md`

上記以外の変更は、必要性を明示できる場合のみ行う。

## 互換性ポリシー

- 入口インターフェースは維持する。
- `scripts/agent_pipeline.py` の CLI 引数契約は維持する。
- `repository_dispatch` のイベント種別と主要 payload キーは維持する。

## トリガー運用ルール

- Issue 起点は `agent-task` ラベル付き Issue を対象にする。
- PR フィードバック起点は、明示コマンド（例: `/agent run`）付きコメントのみ対象にする。
- PR フィードバック起点は、許可された権限者のコメントのみ対象にする。

## ロックと同時実行制御

- 同一 Issue の同時実行は禁止する。
- 同一リポジトリの同時実行数上限を守る（設定値を尊重）。
- `agent/running` ラベルをロックとして扱い、開始時付与・終了時解除を徹底する。

## ログと証跡

- `ai-logs` は専用ブランチへ集約し、実装ブランチへ混在させない。
- UI 変更時の証跡画像は、PR から参照可能な形で残す。
- UI 証跡のために、workflow では日本語フォント前提を崩さない。

## 品質確認

変更後は最低限、該当範囲に応じて以下を実施する。

- `python -m compileall scripts`
- `actionlint`（workflow 変更時）

実行できない確認がある場合は、理由を PR 本文に明記する。

## ドキュメント方針

- 説明ドキュメントは日本語で更新する。
- 挙動変更時は `README.md` と `docs/autonomous-agent-flow.md` を同時に更新する。

## PR 方針

- PR は Draft ではなく Open で作成する。
- 必須ラベル付与ルールを満たす。
- PR 本文はレビューしやすい構成（変更内容・検証結果・証跡リンク）を維持する。
